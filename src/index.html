<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="index.css">
		<title>Interactive Directed Graph</title>
		<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
		<style src="index.css"></style>
	</head>

<div id="title" class="prevent-select">
	Flow Network <span class = "effect">Visualizer</span>
</div>
<body>
	<div id="menu">
		<div id="menu-items" class="prevent-select">
			<button class="menu-item">Ford-Fulkerson</button>
			<button class="menu-item">Edmonds-Karp</button>
			<button class="menu-item">Dinic's</button>
			<a href="/explain.html" class="menu-item">Explained</a>
			<button class="menu-item" onclick="animateTraversal()">Animate</button>
		</div>
	</div>
	<div id="mynetwork"></div>
    <script type="text/javascript">
        var nodes = new vis.DataSet([
            { id: 0, label: 'source' },
            { id: 1, label: 'sink' }
        ]);

        var edges = new vis.DataSet([
            { from: Number, to: Number }
        ]);

        var container = document.getElementById('mynetwork');
        var data = {
            nodes: nodes,
            edges: edges
        };

        var options = {
            edges: {
                arrows: {
                    to: { enabled: true, scaleFactor: 1.2 }
                }
            },
            physics: {
                enabled: false,
                stabilization: true
            },
            manipulation: {
                enabled: true,
                initiallyActive: true,
                addNode: function (data, callback) {
                    // This function is called by the library to add a node
                    var newNodeId = nodes.length + 1;
                    data.label = 'Node ' + newNodeId;
                    data.id = newNodeId;
                    callback(data); // Adds the node to the graph
                },
                addEdge: function (data, callback) {
                    if (data.from === data.to) {
                        alert("Connecting the node to itself is not allowed.");
                    } else {
                        var capacity = prompt("Enter edge capacity:", "1");
                        if (capacity !== null) {
                            data.label = capacity;
                            callback(data);
                        }
                    }
                }
            }
        };

        var network = new vis.Network(container, data, options);

        function addNode() {
            var newNodeId = nodes.length + 1;
            nodes.add({ id: newNodeId, label: 'Node ' + newNodeId });
        }

        function animateTraversal() {
            // Iterate through all nodes
            nodes.getIds().forEach((nodeId, index) => {
                setTimeout(() => {
                    // Highlight node
                    var nodeToUpdate = nodes.get(nodeId);
                    nodeToUpdate.color = 'lime';
                    nodes.update(nodeToUpdate);

                    // Find all connected edges and highlight them
                    edges.get().forEach((edge) => {
                        if (edge.from === nodeId) {
                            var edgeToUpdate = edges.get(edge.id);
                            edgeToUpdate.color = 'red';
                            edges.update(edgeToUpdate);

                            // Animate edge and reset color
                            setTimeout(() => {
                                edgeToUpdate.color = '#848484';
                                edges.update(edgeToUpdate);
                            }, 1000);
                        }
                    });

                    // Reset node color after a delay
                    setTimeout(() => {
                        nodeToUpdate.color = '#97C2FC';
                        nodes.update(nodeToUpdate);
                    }, 2000);
                }, 2000 * index);
            });
        }
    </script>
</body>

</html>